<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Hello World</title>
  <link rel="stylesheet" href="css/resets.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/pageA.css">
  <link rel="stylesheet" href="css/pageB.css">
  <link rel="stylesheet" href="css/pageC.css">
</head>

<body>
  <div id="content-wrap">
    <div class="list-page-group">
      <div class="list-page-item">
        <!-- 第一幅背景 -->
        <div class="a-background">
          <div class="a-background-top"></div>
          <div class="a-background-middle"></div>
          <div class="a-background-bottom"></div>
        </div>
        <!-- 云朵 -->
        <div class="cloud-area">
          <div class="cloud cloud1"></div>
          <div class="cloud cloud2"></div>
        </div>
        <!-- 太阳 -->
        <div id="sun"></div>
      </div>

      <div class="list-page-item">
        <!-- 第二幅背景图  -->
        <div class="b-background"></div>
        <div class="b-background-preload hidden"></div>
        <!-- 商店 -->
        <div class="shop">
          <div class="door">
            <div class="door-left"></div>
            <div class="door-right"></div>
          </div>
          <div class="lamp"></div>
        </div>
        <div class="bird"></div>
      </div>

      <div class="list-page-item">
        <div class="c-background">
          <div class="c-background-top"></div>
          <div class="c-background-middle"></div>
          <div class="c-background-bottom"></div>
        </div>
        <div class="girl" id="girl"></div>
        <div class="bright-bottom">
          <div class="water">
            <div id="water1" class="water-1"></div>
            <div id="water2" class="water-2"></div>
            <div id="water3" class="water-3"></div>
            <div id="water4" class="water-4"></div>
          </div>
        </div>
        <ul class="stars">
          <li class="stars1"></li>
          <li class="stars2"></li>
          <li class="stars3"></li>
          <li class="stars4"></li>
          <li class="stars5"></li>
          <li class="stars6"></li>
        </ul>
      </div>
    </div>
    <div id="boy" class="charector"></div>
    <div id="snowflake">

    </div>
  </div>

  <!-- <script src="js/jquery.min.js"></script>
  <script src="js/jquery.transit.js"></script> -->
  <script src="js/swipe.js"></script>
  <script src="js/qixi.js"></script>
  <script>
    window.onload = function () {
      let container = document.getElementById('content-wrap')
      let swipe = Swipe(container)
      swipe.scrollTo(2, 10)

      ////////////////////////////////////////////////////////
      // =================== 动画处理 ====================== //
      ////////////////////////////////////////////////////////

      /////////////
      // 小孩走路 //
      /////////////

      let boy = BoyWalk()

      let birdDom = document.getElementsByClassName('bird')[0]

      function birdfly() {
        birdDom.classList.add('bird-fly')
        birdDom.style.transition = 'all 15000ms linear'
        birdDom.style.transform = 'translateX(-' + container.clientWidth + 'px)'
      }

      function snowflake() {
        let flakeContainer = document.getElementById('snowflake')

        function getImagesName() {
          return './img/snowflake' + Math.floor(Math.random() * 6 + 1) + '.png'
        }

        function createSnowBox() {
          let url = getImagesName()
          var newDom = document.createElement('div')
          newDom.style.width = '41px'
          newDom.style.height = '41px'
          newDom.style.position = 'absolute'
          newDom.style.top = '41px'
          newDom.style.backgrounSize = 'cover'
          newDom.style.zIndex = '9999'
          newDom.style.backgroundImage = 'url(' + url + ')'
          newDom.classList.add('snowRoll')
          return newDom
        }

        setInterval(() => {
          let initParam = {
            startLeft: Math.random() * visualWidth - 100,
            startBottom: visualHeight - 40,
            startOpacity: 1,
            endTop: visualHeight - 40,
            duration: visualHeight * 10 + Math.random() * 5000,
            randOpacity: (() => {
              let op = Math.random();
              return op < 0.5 ? op + 0.5 : op
            })()
          }

          let snowdom = createSnowBox()
          snowdom.style.left = initParam.startLeft + 'px'
          snowdom.style.opacity = initParam.startOpacity

          flakeContainer.appendChild(snowdom)

          let transX = initParam.startLeft - 100 + Math.random() * 500 - initParam.startLeft
          // let transY = initParam.endTop - 40

          // return

            // snowdom.style.transition = 'transform 20000ms linear'
            // snowdom.style.transform = 'translateY(400px)'

          setTimeout(() => {
            flakeContainer.removeChild(snowdom)
          }, initParam.duration + 100)
        },200)
      }

      document.onkeyup = function (e) {
        if (e.keyCode == 66) {
          snowflake()
        }

        if (e.keyCode == 65) {
          // 太阳运动
          // document.getElementById('sun').classList.add('rotation')

          // document.getElementsByClassName('cloud')[0].classList.add('cloud1Anim') // 飘云
          // document.getElementsByClassName('cloud')[1].classList.add('cloud2Anim')

          // boy.walkTo(2000, .2) // 第一次开始走路
          //   .then(function () {
          //     swipe.scrollTo(1, 5000)
          //     return boy.walkTo(5000, 0.5)
          //   })

          // boy.toShop(5000) // 走进商店
          //   .then(() => { //暂停走路
          //     boy.stopWalk()
          //   })
          //   .then(() => { //开门
          //     return openDoor()
          //   })
          //   .then(function () { // 开灯
          //     lamp.bright()
          //   })
          //   .then(() => { // 进商店
          //     return boy.inShop(2000)
          //   })
          //   .then(() => {
          //     birdfly()
          //     return boy.takeFlower() //取花
          //   })
          //   .then(() => { //出商店
          //     return boy.outShop(2000)
          //   })
          //   .then(() => { //关灯
          //     lamp.dark()
          //   })

          boy.walkTo(2000, .15)
            .then(() => {
              return boy.walkTo(3500, .36, girlDom.offsetTop / visualHeight)
            })
            .then(() => {
              // 上桥走到小女孩面前
              return boy.walkTo(1500, (girlDom.offsetLeft - 123) / visualWidth)
            }).then(() => {
              boy.resetOrigin()
            }).then(() => {
              setTimeout(() => {
                girl.rotate()
                boyDomRotate()
              })
            })
        }
      }
    }

  </script>
</body>

</html>