<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>七夕言情</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/pageA.css">
    <link rel="stylesheet" href="css/pageB.css">
    <link rel="stylesheet" href="css/pageC.css">
    <style>
        button {
            width: 100px;
            height: 50px;
        }

        .button {
            position: absolute;
            bottom: 0;
        }
    </style>
</head>

<body>
    <div id="content">
        <ul class="content-wrap">
            <li>
                <div class="a_background">
                    <!--背景-->
                    <div class="a_background_top"></div>
                    <div class="a_background_middle"></div>
                    <div class="a_background_bottom"></div>
                </div>
                <div id="cloudArea">
                    <div class="cloud cloud1"></div>
                    <div class="cloud cloud2"></div>
                </div>
                <div id="sun"></div>
            </li>
            <li>
                <div class="b_background"></div>
                <div class="b_background_preload"></div>
                <div class="shop">
                    <div class="door">
                        <div class="door-left"></div>
                        <div class="door-right"></div>
                    </div>
                    <div class="lamp"></div>
                </div>
                <div class="bird"> </div>
            </li>
            <li>
                <div class="c_background">
                    <div class="c_background_top"></div>
                    <div class="c_background_middle"></div>
                    <div class="c_background_buttom"></div>
                </div>
                <div class="girl"></div>
                <div class="bridge-bottom">
                    <div class="water">
                        <div id="water1" class="water_1"></div>
                        <div id="water2" class="water_2"></div>
                        <div id="water3" class="water_3"></div>
                        <div id="water4" class="water_4"></div>
                    </div>
                </div>
                <ul class="stars">
                    <li class="star1"></li>
                    <li class="star2"></li>
                    <li class="star3"></li>
                    <li class="star4"></li>
                    <li class="star5"></li>
                    <li class="star6"></li>
                </ul>
                <div class="logo"></div>
            </li>
        </ul>
        <div id="boy" class="charector"></div>
        <div id="snowflake"></div>
        <div class="button">
            <button>开门</button>
            <button>关门</button>
        </div>
    </div>

    <script src="js/jquery.js"></script>
    <script src="js/jquery.transit.js"></script>
    <script src="js/swipe.js"></script>
    <script src="js/QiXi.js"></script>
    <script>
        $(function () {
            var container = $('#content')
            var swipe = Swipe(container)
            swipe.srollTo(container.width() * 2, 0)

            var getValue = function (className) {
                var $elem = $('' + className + '')
                return {
                    height: $elem.height(),
                    top: $elem.position().top
                }
            }

            var bridgeY = function () {
                var data = getValue('.c_background_middle')
                return data.top
            }()

            // $('#sun').addClass('rotation')
            // $('.cloud:first').addClass('cloud1Anim')
            // $('.cloud:last').addClass('cloud2Anim')

            // boy.walkTo(2000, 0.2)
            //     .then(function () {//第一次走路完成
            //         swipe.srollTo(container.width(), 5000)
            //     })
            //     .then(function () {
            //         return boy.walkTo(5000, 0.5)
            //     })

            // boy.walkTo(2000, 0.5) //走到第二幅背景中间位置
            //     .then(function () {
            //         boy.stopWalk() //暂停走路
            //     })
            //     .then(function () {
            //         return openDoor() //打开商店门
            //     })
            //     .then(function () {
            //         lamp.bright() //开灯
            //     })
            //     .then(function () {
            //         return boy.toShop(2000) //进入商店
            //     })
            //     .then(function () {
            //         return boy.talkFlower() //取花
            //     })
            //     .then(function () {
            //         bird.fly()
            //     })
            //     .then(function () {
            //         return boy.outShop(2000)    //出商店
            //     })
            //     .then(function () {
            //         lamp.dark()
            //     })
            //     .then(function () {
            //         return shutDoor()   //关门
            //     })
            //     .then(function () {
            //         lamp.dark()
            //     })


            var girl = {
                elem: $('.girl'),
                getHeight: function () {
                    return this.elem.height()
                },
                getWidth: function () {
                    return this.elem.width()
                },
                setOffset: function () {
                    this.elem.css({
                        left: container.width() / 2,
                        top: bridgeY - this.getHeight()
                    })
                },
                getOffset: function () {
                    return this.elem.offset()
                },
                rotate: function () {
                    this.elem.addClass('girl-rotate')
                }
            }

            girl.setOffset()

            var boy = BoyWalk()

            var bird = {
                elem: $('.bird'),
                fly: function () {
                    this.elem.addClass('birdFly')
                    this.elem.transition({
                        right: container.width()
                    }, 15000, 'linear')
                }
            }

            var logo = {
                elem: $('.logo'),
                run: function () {
                    this.elem.addClass('logolightSpeedIn')
                        .on(animationEnd, function () {
                            $(this).addClass('logoshake').off()
                        })
                }
            }

            var snowflakeUrl = [
                './images/snowflake/snowflake1.png',
                './images/snowflake/snowflake2.png',
                './images/snowflake/snowflake3.png',
                './images/snowflake/snowflake4.png',
                './images/snowflake/snowflake5.png',
                './images/snowflake/snowflake6.png'
            ]

            function snowflake() {
                var $flakeContainer = $('#snowflake')

                function createSnowBox() {
                    var url = snowflakeUrl[Math.floor(Math.random() * 6)]
                    return $('<div class="snowBox"></div>').css({
                        width: 41,
                        height: 41,
                        position: 'absolute',
                        backgroundSize: 'cover',
                        'zIndex': 100000,
                        'top': '-41px',
                        'backgroundImage': 'url(' + url + ')'
                    }).addClass('snowRoll')
                }

                setInterval(function () {
                    var randomStart = Math.random()
                    randomStart = randomStart < 0.5 ? 1 : randomStart
                    
                    var startPositionLeft = Math.random() * container.width() - 100
                    var endPositionLeft = startPositionLeft - 100 + Math.random * 500

                    var $flake = createSnowBox()
                    $flake.css({
                        left: startPositionLeft,
                        opacity: randomStart
                    })
                    $flakeContainer.append($flake)

                    $flake.transition({
                        top: container.height() - 40,
                        left: endPositionLeft,
                        opacity:0.7
                    }, container.height() * 10 + Math.random() * 5000, 'easy-out', function(){
                        $(this).remove()
                    })
                }, 200)
            }

            var audioConfig = {
                enable: true,
                playUrl: './music/happy.wav',
                cycleUrl: './music/circulation.wav'
            }

            function Html5Audio (url, isloop) {
                var audio = new Audio(url);
                audio.autoplay = true
                audio.loop = isloop || false
                audio.play()
                return {
                    end: function (callback) {
                        audio.addEventListener('ended', callback, false)
                    }
                }
            }

            $('button:first').click(function () {
                Html5Audio(audioConfig.playUrl).end(function(){
                    Html5Audio(audioConfig.cycleUrl, true)
                })

                // snowflake()

                // boy.walkTo(2000, 0.15)
                //     .then(function () {
                //         return boy.walkTo(1500, 0.25, ((bridgeY - girl.getHeight()) / container.height()))
                //     })
                //     .then(function () {
                //         var proportionX = (girl.getOffset().left - boy.getWidth() + girl.getWidth() / 5) / container.width()
                //         return boy.walkTo(1500, proportionX);
                //     })
                //     .then(function () {
                //         boy.resetOriginal();
                //     })
                //     .then(function () {
                //         setTimeout(function () {
                //             girl.rotate()
                //             boy.rotate(function () {
                //                 logo.run()
                //             })
                //         }, 1000)
                //     })
            })
        })
    </script>
</body>

</html>