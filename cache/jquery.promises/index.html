<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <div id="log">

  </div>
  <script>
    'use strict'
    let promiseCount = 0

    function promiseDemo() {
      let thisPromiseCount = ++promiseCount

      let log = document.getElementById('log')
      log.insertAdjacentHTML('beforeend', `<br/><br/>第${thisPromiseCount}次点击: <br/><small>同步代码开始...</small><br/>`)

      // 新构建一个 Promise 实例：使用Promise实现每过一段时间给计数器加一的过程，每段时间间隔为1~3秒不等
      let p1 = new Promise((resolve, reject) => {
        let consume = Math.random() * 2000 + 1000
        log.insertAdjacentHTML('beforeend', '<small>Promise异步代码开始...</small><br/>')
        window.setTimeout(function () {
          resolve('Promise异步代码结束! 耗时:' + consume)
        }, consume)
      })

      // Promise不论成功或失败都会调用 then
      // catch() 只有当promise失败时调用
      p1.then(function (data) {
        log.insertAdjacentHTML('beforeend', '<small>' + data + '</small>')
      })
        .catch(function (reason) {
          console.log('处理失败的promise(' + reason + ')')
        })

      log.insertAdjacentHTML('beforeend', '<small>Promise made 同步代码结束</small><br/>')
    }

    document.onclick = function () {
      promiseDemo()
    }
  </script>
</body>

</html>